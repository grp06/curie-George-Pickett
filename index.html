<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Curie</title>
  <link rel="stylesheet" media="all" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css" />
  <link rel="stylesheet" media="all" href="css/index.css" />
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
</head>

<body>
  <div id="app"></div>
  <script type="text/babel" data-presets="react">

    //======
    // DATA
    //======

    const TEAMS = [
      {
        id: 1,
        name: "Blue Dot",
        identicolor: "#2A8ED1"
      },
      {
        id: 2,
        name: "Cofounders",
        identicolor: "#1CC7D0"
      },
      {
        id: 3,
        name: "Product",
        identicolor: "#FEB414"
      },
      {
        id: 4,
        name: "Growth",
        identicolor: "#17CF6D"
      }
    ];

    const TEAM_MEMBERS = [
      {
        id: 1,
        name: "Will Goto",
        identicolor: "#2A8ED1",
        teams: [1, 2, 3, 4]
      },
      {
        id: 2,
        name: "Macgill Davis",
        identicolor: "#1CC7D0",
        teams: [1, 2, 3]
      },
      {
        id: 3,
        name: "Sheel Gupta",
        identicolor: "#FEB414",
        teams: [1, 4]
      },
      {
        id: 4,
        name: "Kush Panjabi",
        identicolor: "#17CF6D",
        teams: [1, 4]
      },
      {
        id: 5,
        name: "Asli Kimya",
        identicolor: "#FF5263",
        teams: [1, 3]
      },
      {
        id: 6,
        name: "Justine De Caires",
        identicolor: "#866EFF",
        teams: [1, 3]
      },
      {
        id: 7,
        name: "Lana Zheng",
        identicolor: "#C7573E",
        teams: [1, 4]
      },
      {
        id: 8,
        name: "Tosh Velaga",
        identicolor: "#5EB1FF",
        teams: [1, 4]
      },
      {
        id: 9,
        name: "Jade Hornes",
        identicolor: "#FF6E4A",
        teams: [1, 4]
      }
    ];

    const IdenticonBadge = ({ team }) => {
      const getInitial = team => {
        if (team.name) {
          return team.name[0];
        }
        return team[0].name[0];
      };

      const getName = name => {
        if (team.name) {
          return team.name;
        }
        return name[0].name;
      };

      const getColor = team => {
        if (team.name) {
          return team.identicolor;
        }
        return team[0].identicolor;
      };

      return (
        <div className="IdenticonBadge">
          <div
            className="IdenticonBadge__icon"
            style={{ backgroundColor: getColor(team) }}
          >
            {getInitial(team)}
          </div>

          <p className="IdenticonBadge__name">{getName(team)}</p>
        </div>
      );
    };

    const Dropdown = ({ renderTrigger, maybeRenderOptions, type }) => {
      return (
        <div className="Dropdown">
          {renderTrigger(type)}
          {maybeRenderOptions(type)}
        </div>
      );
    };

    class App extends React.Component {
      constructor(props) {
        super(props);

        this.state = {
          selectedTeam: TEAMS[0],
          selectedMember: TEAM_MEMBERS[0],
          filteredMembers: this.filterTeamMembers(1),
          shouldShowOptions: {
            teams: false,
            members: false
          }
        };
      }

      onTriggerClick = triggerType => {
        const { shouldShowOptions } = this.state;
        const clickedDropdownVal = shouldShowOptions[triggerType];

        this.setState({
          shouldShowOptions: {
            [triggerType]: !clickedDropdownVal
          }
        });
      };

      closeMenu = () => {
        this.setState({
          shouldShowOptions: {
            teams: false,
            members: false
          }
        });
      };

      filterTeamMembers = id => {
        const filtered = TEAM_MEMBERS.filter(
          member => member.teams.indexOf(id) > -1
        );
        return filtered;
      };

      onOptionClick(item) {
        const memberClicked = item.teams;

        // if the option we click is a member, we want to set selectedMember to that person
        // otherwise, we should set selectedTeam appropriately and filter the memberList accordingly

        if (memberClicked) {
          this.setState({
            selectedMember: item,
            shouldShowOptions: {
              teams: false,
              members: false
            }
          });
        } else {
          const filteredTeam = this.filterTeamMembers(item.id);

          this.setState({
            selectedMember: filteredTeam[0],
            selectedTeam: item,
            filteredMembers: filteredTeam,
            shouldShowOptions: {
              teams: false,
              members: false
            }
          });
        }
      }

      renderTrigger(triggerType) {
        const { selectedTeam, selectedMember } = this.state;
        const teamOrMember =
          triggerType === "teams" ? selectedTeam : selectedMember;

        return (
          <div
            className="Dropdown__trigger"
            onClick={() => this.onTriggerClick(triggerType)}
            onKeyPress={() => this.onTriggerClick(triggerType)}
            tabIndex="1"
          >
            <IdenticonBadge team={teamOrMember} />
          </div>
        );
      }

      maybeRenderOptions(optionsType) {
        const { shouldShowOptions, selectedTeam, filteredMembers } = this.state;
        let arrToMap = optionsType === "teams" ? TEAMS : filteredMembers;

        return (
          shouldShowOptions[optionsType] && (
            <div className="Dropdown__options" tabIndex="1">
              {arrToMap.map(item => this.renderOption(item))}
            </div>
          )
        );
      }

      renderOption(option) {
        return (
          <div
            key={option.id}
            className="Dropdown__option"
            onClick={() => this.onOptionClick(option)}
            tabIndex="1"
            onKeyPress={() => this.onOptionClick(option)}
          >
            <IdenticonBadge team={option} />
          </div>
        );
      }

      render() {
        const { shouldShowOptions } = this.state;
        const aDropdownIsOpen =
          shouldShowOptions.teams || shouldShowOptions.members;

        return (
          <div className="App">
            <h1>Select a team</h1>
            <Dropdown
              renderTrigger={() => this.renderTrigger("teams")}
              maybeRenderOptions={() => this.maybeRenderOptions("teams")}
              type="teams"
            />
            <Dropdown
              renderTrigger={() => this.renderTrigger("members")}
              maybeRenderOptions={() => this.maybeRenderOptions("members")}
              type="members"
            />
            <div
              onClick={this.closeMenu}
              className={aDropdownIsOpen ? "closeMenuOverlay" : ""}
            />
          </div>
        );
      }
    }

    ReactDOM.render(<App />, document.getElementById("app"));
  </script>
</body>

</html>